<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><meta charset="UTF-8"/><title>Pending Bookings</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<div class="container">
  <h2>Pending Approvals</h2>
  <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

  <table>
    <thead>
    <tr><th>ID</th><th>Customer</th><th>Vehicle</th><th>From</th><th>To</th><th>Total</th><th>Assign Driver</th><th>Actions</th></tr>
    </thead>
    <tbody>
    <tr th:each="b : ${pending}">
      <td th:text="${b.id}"></td>
      <td th:text="${b.customerId}"></td>
      <td th:text="${b.vehicleId}"></td>
      <td th:text="${b.pickupDateTime}"></td>
      <td th:text="${b.returnDateTime}"></td>
      <td th:text="${b.estimatedTotal} + ' LKR'"></td>

      <!-- Assign driver dropdown -->
      <td>
        <form th:action="@{/admin/bookings/{id}/assign(id=${b.id})}" method="post">
          <select name="driverId" required>
            <option value="" disabled selected>Select driver</option>
            <option th:each="d : ${drivers}" th:value="${d.id}"
                    th:text="${d.username + ' (#' + d.id + ')'}"></option>
          </select>
          <input type="text" name="note" placeholder="Note (optional)"/>
          <button type="submit">Assign</button>
        </form>
        <div th:if="${b.assignedDriverId != null}">
          <small>Assigned: <span th:text="${b.assignedDriverId}"></span></small>
        </div>
      </td>

      <td>
        <form th:action="@{/admin/bookings/{id}/approve(id=${b.id})}" method="post" style="display:inline">
          <button type="submit">Approve & Capture</button>
        </form>
        <form th:action="@{/admin/bookings/{id}/reject(id=${b.id})}" method="post" style="display:inline">
          <button type="submit">Reject</button>
        </form>
      </td>
    </tr>
    </tbody>
  </table>
</div>
</body>
</html>
