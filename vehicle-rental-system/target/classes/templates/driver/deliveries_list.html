<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>DriveEase • Driver • Deliveries</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--primary:#2c3e50;--secondary:#3498db;--accent:#e74c3c;--success:#2ecc71;--dark:#2c3e50;--shadow:0 4px 6px rgba(0,0,0,.1)}
    *{box-sizing:border-box;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}
    body{margin:0;background:#f8f9fa;color:#333;min-height:100vh;display:flex;flex-direction:column}
    header{background:linear-gradient(135deg,var(--primary),#1f2a3a);color:#fff;padding:18px 0;box-shadow:var(--shadow)}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    .row{display:flex;align-items:center;justify-content:space-between}
    .logo{display:flex;align-items:center;gap:10px}
    .logo i{color:var(--secondary);font-size:28px}
    main{flex:1;padding:28px 0}
    .card{background:#fff;border-radius:12px;box-shadow:var(--shadow);padding:18px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px;border-bottom:1px solid #eee;text-align:left}
    th{background:#fafafa}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .SCHEDULED{background:#e8f4ff;color:#1f6fba}
    .IN_PROGRESS{background:#e8ffef;color:#167a3d}
    .COMPLETED{background:#eef8f0;color:#2a7c46}
    .CANCELLED{background:#ffecec;color:#b12e2e}
    .btn{border:none;border-radius:8px;padding:8px 12px;cursor:pointer;font-weight:700}
    .btn-primary{background:#3498db;color:#fff}
    .btn-primary:hover{background:#2d7fbb}
    .btn-success{background:#2ecc71;color:#fff}
    .btn-danger{background:#e74c3c;color:#fff}
    footer{background:var(--dark);color:#fff;padding:24px 0;margin-top:auto}
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="row">
      <div class="logo"><i class="fas fa-car"></i><h2 style="margin:0">DriveEase • Driver</h2></div>
      <div><a th:href="@{/driver}" style="color:#fff;text-decoration:none">Dashboard</a></div>
    </div>
  </div>
</header>

<main>
  <div class="container">
    <div class="card">
      <h3 style="margin-top:0">My Deliveries</h3>

      <div style="overflow:auto">
        <table>
          <thead>
          <tr>
            <th>#</th>
            <th>Vehicle</th>
            <th>Customer</th>
            <th>Pickup → Drop</th>
            <th>Window</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="d,idx : ${deliveries}">
            <td th:text="${idx.index + 1}">1</td>
            <td th:text="${d.vehicleId}">V-101</td>
            <td th:text="${d.customerName}">John</td>
            <td>
              <div><strong th:text="${d.pickupLocation}">Pickup</strong></div>
              <div th:text="${d.dropoffLocation}" style="opacity:.7">Drop</div>
            </td>
            <td>
              <div th:text="${#temporals.format(d.scheduledStart,'yyyy-MM-dd HH:mm')}">2025-09-29 09:00</div>
              <div style="opacity:.7">→ <span th:text="${#temporals.format(d.scheduledEnd,'yyyy-MM-dd HH:mm')}">11:00</span></div>
            </td>
            <td><span class="pill" th:text="${d.status}" th:classappend="' '+${d.status}">SCHEDULED</span></td>
            <td style="display:flex;gap:6px;flex-wrap:wrap">
              <form th:if="${d.status.name() == 'SCHEDULED'}"
                    th:action="@{|/driver/deliveries/${d.id}/start|}" method="post">
                <button class="btn btn-primary" type="submit"><i class="fa fa-play"></i>&nbsp;Start</button>
              </form>
              <form th:if="${d.status.name() == 'IN_PROGRESS'}"
                    th:action="@{|/driver/deliveries/${d.id}/complete|}" method="post">
                <button class="btn btn-success" type="submit"><i class="fa fa-flag-checkered"></i>&nbsp;Complete</button>
              </form>
              <a th:if="${d.status.name() == 'COMPLETED'}"
                 th:href="@{|/driver/inspections/new?deliveryId=${d.id}&vehicleId=${d.vehicleId}|}"
                 class="btn btn-primary"><i class="fa fa-clipboard-check"></i>&nbsp;Inspection</a>
            </td>
          </tr>
          <tr th:if="${#lists.isEmpty(deliveries)}">
            <td colspan="7" style="opacity:.7">No deliveries yet.</td>
          </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</main>

<footer>
  <div class="container">© DriveEase Vehicle Rental • Driver</div>
</footer>
</body>
</html>
