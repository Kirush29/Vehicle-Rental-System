<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layouts/main :: head('Manage Users')}">
    <title>Manage Users</title> <!-- fallback title for IDE -->
</head>
<body>
<div th:replace="~{layouts/main :: navigation}"></div>

<div class="flex pt-16">
    <div th:replace="~{layouts/main :: sidebar}"></div>

    <main class="flex-1 ml-64 p-8">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Manage Users</h1>
            <a href="/admin/users/create" class="bg-blue-600 text-white px-4 py-2 rounded-lg">Add New User</a>
        </div>

        <!-- Search -->
        <form method="get" class="mb-4">
            <label for="q" class="sr-only">Search</label>
            <input id="q" name="q" th:value="${query}" class="border rounded px-3 py-2"
                   placeholder="Search name/email/username"/>
            <button class="ml-2 px-3 py-2 bg-gray-800 text-white rounded">Search</button>
        </form>

        <!-- Table -->
        <div class="bg-white rounded-xl shadow divide-y">
            <div class="grid grid-cols-6 px-4 py-3 font-semibold">
                <div>Full Name</div>
                <div>Email</div>
                <div>Username</div>
                <div>Roles</div>
                <div>Status</div>
                <div class="text-right">Actions</div>
            </div>

            <div th:each="u : ${users.content}" class="grid grid-cols-6 px-4 py-3 items-center">
                <div th:text="${u.fullName}">John Doe</div>
                <div th:text="${u.email}">john@example.com</div>
                <div th:text="${u.username}">john</div>

                <!-- Roles -->
                <div>
          <span th:each="r : ${u.roles}"
                class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded mr-1"
                th:text="${#strings.substring(r, 5)}">CUSTOMER</span>
                </div>

                <!-- Enabled/Disabled -->
                <div>
          <span class="text-xs px-2 py-1 rounded"
                th:classappend="${u.enabled} ? ' bg-green-100 text-green-800' : ' bg-gray-200 text-gray-700'"
                th:text="${u.enabled} ? 'Enabled' : 'Disabled'">Enabled</span>
                </div>

                <!-- Actions -->
                <div class="text-right">
                    <a th:href="@{/admin/users/{id}/edit(id=${u.id})}" class="text-blue-600 mr-3">Edit</a>

                    <form th:action="@{/admin/users/{id}/delete(id=${u.id})}" method="post" class="inline"
                          onsubmit="return confirm('Delete this user?');">
                        <button class="text-red-600" type="submit">Delete</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Paging -->
        <div class="mt-4 flex justify-between text-sm text-gray-600">
            <span th:text="'Showing ' + (users.number + 1) + ' / ' + users.totalPages + ' pages'">Showing 1 / 1 pages</span>
            <div>
                <a th:if="${!users.first}"
                   th:href="@{/admin/users(page=${users.number - 1}, q=${query})}"
                   class="mr-3">Prev</a>
                <a th:if="${!users.last}"
                   th:href="@{/admin/users(page=${users.number + 1}, q=${query})}">Next</a>
            </div>
        </div>
    </main>
</div>
</body>
</html>
