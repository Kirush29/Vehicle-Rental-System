<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>DriveEase • Admin • New Delivery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--primary:#2c3e50;--secondary:#3498db;--accent:#e74c3c;--light:#ecf0f1;--dark:#2c3e50;--shadow:0 4px 6px rgba(0,0,0,.1)}
    *{box-sizing:border-box;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}
    body{margin:0;background:#f8f9fa;color:#333;min-height:100vh;display:flex;flex-direction:column}
    header{background:linear-gradient(135deg,var(--primary),#1f2a3a);color:#fff;padding:18px 0;box-shadow:var(--shadow)}
    .container{max-width:900px;margin:0 auto;padding:0 20px}
    .row{display:flex;align-items:center;justify-content:space-between}
    .logo{display:flex;align-items:center;gap:10px}
    .logo i{color:var(--secondary);font-size:28px}
    main{flex:1;padding:28px 0}
    .card{background:#fff;border-radius:12px;box-shadow:var(--shadow);padding:18px}
    label{display:block;margin:10px 0 6px;font-weight:700}
    input,textarea,select{width:100%;padding:12px;border:1px solid #ddd;border-radius:10px}
    .grid{display:grid;gap:14px}
    .g2{grid-template-columns:repeat(2,1fr)}
    .muted{opacity:.7}
    .btn{border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btn-primary{background:#3498db;color:#fff}
    .btn-primary:hover{background:#2d7fbb}
    .btn-ghost{background:transparent;border:2px solid #3498db;color:#3498db}
    .err{background:#ffefef;border-left:4px solid #e74c3c;padding:10px;border-radius:8px;margin-bottom:10px}
    footer{background:var(--dark);color:#fff;padding:24px 0;margin-top:auto}
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="row">
      <div class="logo"><i class="fas fa-car"></i><h2 style="margin:0">DriveEase • Admin</h2></div>
      <div><a th:href="@{/admin/deliveries}" class="btn btn-ghost">Back to Deliveries</a></div>
    </div>
  </div>
</header>

<main>
  <div class="container">
    <div class="card">
      <h3 style="margin-top:0">Create Delivery</h3>

      <!-- Optional server message via redirect param -->
      <div th:if="${param.err}" class="err" th:text="${param.err}">Please fix the errors and try again.</div>

      <!-- NOTE: No th:object here; use plain name= fields to bind to DeliveryRequest -->
      <form th:action="@{/admin/deliveries}" method="post" onsubmit="return validateForm()">
        <div class="grid g2">
          <!-- Vehicle ID -->
          <div>
            <label for="vehicleId">Vehicle ID</label>
            <input id="vehicleId" name="vehicleId" type="number" required min="1" />
          </div>

          <!-- Driver ID -->
          <div>
            <label for="driverId">Driver ID</label>
            <input id="driverId" name="driverId" type="number" required min="1" />
          </div>

          <!-- Customer Name -->
          <div>
            <label for="customerName">Customer Name</label>
            <input id="customerName" name="customerName" type="text" required minlength="3" maxlength="80" />
          </div>

          <!-- Notes -->
          <div>
            <label for="notes">Notes <span class="muted">(optional, ≤ 250)</span></label>
            <input id="notes" name="notes" type="text" maxlength="250" />
          </div>

          <!-- Pickup -->
          <div>
            <label for="pickupLocation">Pickup Location</label>
            <input id="pickupLocation" name="pickupLocation" type="text" required minlength="5" maxlength="200" />
          </div>

          <!-- Drop-off -->
          <div>
            <label for="dropoffLocation">Drop-off Location</label>
            <input id="dropoffLocation" name="dropoffLocation" type="text" required minlength="5" maxlength="200" />
          </div>

          <!-- Start -->
          <div>
            <label for="scheduledStart">Start (within 08:00–20:00)</label>
            <input id="scheduledStart" name="scheduledStart" type="datetime-local" required />
          </div>

          <!-- End -->
          <div>
            <label for="scheduledEnd">End (after start)</label>
            <input id="scheduledEnd" name="scheduledEnd" type="datetime-local" required />
          </div>
        </div>

        <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end">
          <a th:href="@{/admin/deliveries}" class="btn btn-ghost">Cancel</a>
          <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i>&nbsp;Save Delivery</button>
        </div>
      </form>
    </div>
  </div>
</main>

<footer>
  <div class="container"><span class="muted">© DriveEase Vehicle Rental</span></div>
</footer>

<script>
  function withinHours(dt){
    const d = new Date(dt);
    if (isNaN(d.getTime())) return false;
    const h = d.getHours();
    return h >= 8 && h <= 20;
  }
  function validateForm(){
    const s = document.getElementById('scheduledStart').value;
    const e = document.getElementById('scheduledEnd').value;
    if(!s || !e) return true;
    const start = new Date(s), end = new Date(e), now = new Date();
    if(end <= start){ alert("End must be after start."); return false; }
    if(start < now){ alert("Start cannot be in the past."); return false; }
    if(!withinHours(s) || !withinHours(e)){ alert("Window must be within 08:00–20:00."); return false; }
    return true;
  }
</script>
</body>
</html>
