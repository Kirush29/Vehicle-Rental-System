<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:fragment="head(pageTitle)">
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title th:text="${pageTitle} + ' - Vehicle Rental System'">Vehicle Rental System</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css" rel="stylesheet"/>
  <style>
    .sidebar{transition:all .3s}.sidebar.collapsed{width:64px}.main-content{transition:all .3s}
    .hover-scale{transition:transform .2s}.hover-scale:hover{transform:scale(1.05)}
  </style>
</head>

<body class="bg-gray-100">

<!-- NAV -->
<nav th:fragment="navigation" class="bg-blue-600 text-white shadow-lg fixed w-full top-0 z-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between h-16">
      <div class="flex items-center">
        <button id="sidebarToggle" class="mr-4 text-white"><i class="fas fa-bars"></i></button>
        <i class="fas fa-car text-2xl mr-2"></i>
        <span class="font-semibold text-xl">VehicleRental Pro</span>
      </div>
      <div class="flex items-center space-x-4">
        <span sec:authentication="name" class="text-blue-100"></span>
        <div class="relative group">
          <button class="flex items-center space-x-2 bg-blue-700 px-4 py-2 rounded-lg hover:bg-blue-800">
            <i class="fas fa-user-circle"></i><span>Account</span><i class="fas fa-chevron-down"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden group-hover:block z-50">
            <a href="/profile" class="block px-4 py-2 text-gray-800 hover:bg-blue-100"><i class="fas fa-user mr-2"></i>Profile</a>
            <a href="/change-password" class="block px-4 py-2 text-gray-800 hover:bg-blue-100"><i class="fas fa-key mr-2"></i>Change Password</a>
            <div class="border-t my-1"></div>
            <form th:action="@{/logout}" method="post">
              <button type="submit" class="w-full text-left px-4 py-2 text-gray-800 hover:bg-blue-100">
                <i class="fas fa-sign-out-alt mr-2"></i>Sign out
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- SIDEBAR -->
<aside th:fragment="sidebar" id="sidebar" class="sidebar bg-white shadow-md min-h-screen w-64 fixed">
  <nav class="mt-6">
    <div sec:authorize="hasRole('ADMIN')">
      <a href="/admin/dashboard" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-tachometer-alt mr-3"></i><span>Dashboard</span></a>
      <a href="/admin/users" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-users mr-3"></i><span>Manage Users</span></a>
      <a href="/admin/vehicles" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-car mr-3"></i><span>Manage Vehicles</span></a>
      <a href="/admin/reports" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-chart-bar mr-3"></i><span>Reports</span></a>
    </div>

    <div sec:authorize="hasRole('CUSTOMER')">
      <a href="/customer/dashboard" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-tachometer-alt mr-3"></i><span>Dashboard</span></a>
      <a href="/customer/vehicles" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-car mr-3"></i><span>Browse Vehicles</span></a>
      <a href="/customer/rentals" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-calendar-alt mr-3"></i><span>My Rentals</span></a>
      <a href="/customer/profile" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-user mr-3"></i><span>Profile</span></a>
    </div>

    <div sec:authorize="hasRole('FINANCE_MANAGER')">
      <a href="/finance/dashboard" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-tachometer-alt mr-3"></i><span>Dashboard</span></a>
      <a href="/finance/transactions" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-receipt mr-3"></i><span>Transactions</span></a>
      <a href="/finance/reports" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-chart-line mr-3"></i><span>Financial Reports</span></a>
    </div>

    <div sec:authorize="hasRole('DRIVER')">
      <a href="/driver/dashboard" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-tachometer-alt mr-3"></i><span>Dashboard</span></a>
      <a href="/driver/schedule" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-calendar mr-3"></i><span>Schedule</span></a>
      <a href="/driver/assignments" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-tasks mr-3"></i><span>Assignments</span></a>
    </div>

    <div sec:authorize="hasRole('STAFF')">
      <a href="/staff/dashboard" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-tachometer-alt mr-3"></i><span>Dashboard</span></a>
      <a href="/staff/rentals" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-clipboard-list mr-3"></i><span>Manage Rentals</span></a>
      <a href="/staff/vehicles" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-600"><i class="fas fa-car mr-3"></i><span>Manage Vehicles</span></a>
    </div>
  </nav>
</aside>

<!-- FLASH -->
<div th:fragment="flash-messages">
  <div th:if="${success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
    <i class="fas fa-check-circle mr-2"></i><span th:text="${success}">Success</span>
  </div>
  <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    <i class="fas fa-exclamation-circle mr-2"></i><span th:text="${error}">Error</span>
  </div>
</div>

<!-- FOOTER (optional) -->
<footer th:fragment="footer" class="bg-gray-200 text-center p-4 mt-8">
  <p>&copy; <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> Vehicle Rental System</p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function(){
    const t = document.getElementById('sidebarToggle');
    if (t) t.addEventListener('click', function(){
      const sidebar = document.getElementById('sidebar');
      const main = document.getElementById('mainContent');
      if (sidebar) sidebar.classList.toggle('collapsed');
      if (main){ main.classList.toggle('ml-64'); main.classList.toggle('ml-16'); }
    });
    setTimeout(() => {
      document.querySelectorAll('.bg-green-100, .bg-red-100').forEach(el => {
        el.style.transition = 'opacity .5s'; el.style.opacity = '0'; setTimeout(() => el.remove(), 500);
      });
    }, 5000);
  });
</script>
</body>
</html>
